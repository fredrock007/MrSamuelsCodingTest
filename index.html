<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Disa ‚Ä¢ Coding & Robotics MCQ (Grade 5 ‚Ä¢ 100 Questions)</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#f5f6f8;
      --surface:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#dde3ea;
      --brand:#b11226;   /* Disa red */
      --brand2:#8f0e1e;
      --ok:#1b7f3b;
      --flag:#b45309;
      --shadow:0 10px 26px rgba(17,24,39,.10);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

    .topbar{
      background:linear-gradient(90deg,var(--brand),#7f0b18);
      color:#fff; padding:14px 18px; display:flex; align-items:center; gap:16px;
      box-shadow:var(--shadow);
    }
    .logo{
      width:88px;height:88px;border-radius:10px;background:#fff;display:flex;align-items:center;justify-content:center;
      overflow:hidden; flex:0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:contain}
    .topmeta{flex:1}
    .topmeta .course{font-size:28px;font-weight:800;line-height:1.05}
    .topmeta .quiz{opacity:.95;margin-top:4px}

    .timerBox{
      display:flex;flex-direction:column;align-items:flex-end;gap:8px;min-width:180px
    }
    .pill{
      background:rgba(255,255,255,.16); border:1px solid rgba(255,255,255,.25);
      padding:10px 14px;border-radius:999px;font-weight:800;
    }
    .copyright{font-size:12px;opacity:.9}
    .divider{height:3px;background:#fff;opacity:.08}

    .wrap{max-width:1400px;margin:16px auto;padding:0 14px;display:grid;grid-template-columns:360px 1fr;gap:14px}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}

    .sidebar{padding:14px}
    .h1{font-size:20px;font-weight:900;margin:0 0 6px}
    .sub{color:var(--muted);font-size:13px;margin:0 0 12px}

    label{display:block;color:var(--muted);font-weight:800;font-size:13px;margin:12px 0 6px}
    select,input{
      width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--border);outline:none;
      font-size:14px;background:#fff;
    }

    .smallrow{display:flex;gap:10px}
    .smallrow > div{flex:1}

    .legend{display:flex;gap:14px;align-items:center;margin:12px 0 10px;color:var(--muted);font-size:13px}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:6px;border:1px solid var(--border)}
    .d0{background:#e5e7eb}
    .d1{background:var(--ok);border-color:rgba(0,0,0,.08)}
    .d2{background:var(--flag);border-color:rgba(0,0,0,.08)}

    .navgrid{
      border-top:1px solid var(--border);
      padding-top:12px;margin-top:12px;
      display:grid;grid-template-columns:repeat(10,1fr);gap:6px;
      max-height:240px;overflow:auto;
    }
    .qbtn{
      border:1px solid var(--border);
      background:#fff;border-radius:10px;padding:8px 0;font-size:12px;font-weight:900;
      cursor:pointer;
    }
    .qbtn.answered{background:rgba(27,127,59,.10);border-color:rgba(27,127,59,.25)}
    .qbtn.flagged{background:rgba(180,83,9,.12);border-color:rgba(180,83,9,.28)}
    .qbtn.active{outline:3px solid rgba(177,18,38,.20);border-color:rgba(177,18,38,.35)}

    .sideActions{display:flex;gap:10px;margin-top:12px}
    .btn{
      padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;font-weight:900;cursor:pointer;
    }
    .btn.red{border-color:rgba(177,18,38,.35);color:var(--brand)}

    .main{padding:14px}
    .titleRow{padding:14px;border-bottom:1px solid var(--border)}
    .titleRow h2{margin:0;font-size:22px}
    .titleRow p{margin:6px 0 0;color:var(--muted)}

    .controls{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;padding:14px;border-bottom:1px solid var(--border)
    }
    .controls .spacer{flex:1}
    .btn.big{padding:10px 14px}
    .btn.brand{background:var(--brand);color:#fff;border-color:transparent}
    .btn.brand:hover{background:var(--brand2)}

    .content{padding:14px;min-height:420px}

    .qhead{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;margin-bottom:10px}
    .qno{font-weight:900}
    .qtext{font-size:18px;font-weight:900}
    .metaLine{color:var(--muted);font-size:12px;margin-top:4px}

    .choices{display:grid;gap:10px;margin-top:12px}
    .choice{
      border:1px solid var(--border);border-radius:12px;padding:12px;cursor:pointer;display:flex;gap:10px;align-items:flex-start;
    }
    .choice input{width:auto;margin-top:2px}
    .choice.selected{border-color:rgba(177,18,38,.35);background:rgba(177,18,38,.06)}

    .notice{
      padding:10px 12px;border-radius:12px;border:1px dashed rgba(177,18,38,.30);
      background:rgba(177,18,38,.06); color:var(--brand); font-weight:900; font-size:13px;
      margin:10px 0 0;
    }

    .resultBox{
      margin-top:14px;padding:12px;border-radius:12px;border:1px solid var(--border);background:#fff;
    }
    .resultBox .score{font-size:22px;font-weight:900}
    .resultBox .small{color:var(--muted)}

    .foot{padding:10px 14px;color:var(--muted);font-size:12px;border-top:1px solid var(--border)}

    /* iPad / smaller screens */
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr}
      .timerBox{min-width:auto}
      .topmeta .course{font-size:22px}
      .logo{width:72px;height:72px}
      .navgrid{max-height:220px}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="logo">
      <img src="disa-logo.png" alt="Disa Primary School Logo" onerror="this.style.display='none'">
    </div>
    <div class="topmeta">
      <div class="course">Course: Coding & Robotics (Grade 5)</div>
      <div class="quiz">Quiz: (100 Questions)</div>
    </div>
    <div class="timerBox">
      <div class="pill">Time left&nbsp;&nbsp;<span id="timeLeft">35:00</span></div>
      <div class="copyright">¬© MR SAMUELS</div>
    </div>
  </div>
  <div class="divider"></div>

  <div class="wrap">
    <!-- SIDEBAR -->
    <div class="card sidebar">
      <div class="h1">Quiz navigation</div>
      <p class="sub"><b>Total:</b> 100 questions ‚Ä¢ Auto-submit at 0</p>

      <label for="classSelect">Class</label>
      <select id="classSelect">
        <option value="">Select class...</option>
      </select>

      <label for="learnerSelect">Learner</label>
      <select id="learnerSelect" disabled>
        <option value="">Select learner...</option>
      </select>

      <div class="smallrow">
        <div>
          <label>Grade</label>
          <div style="padding:12px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;font-weight:900" id="gradeView">‚Äî</div>
        </div>
        <div>
          <label>Class</label>
          <input id="classBox" placeholder="e.g., 5B" />
        </div>
      </div>

      <label>Learner name</label>
      <input id="learnerBox" placeholder="e.g., A. Smith" />

      <div class="legend">
        <span><span class="dot d0"></span>Not answered</span>
        <span><span class="dot d1"></span>Answered</span>
        <span><span class="dot d2"></span>Flagged</span>
      </div>

      <div class="navgrid" id="navGrid"></div>

      <div class="sideActions">
        <button class="btn" id="saveBtn">Save</button>
        <button class="btn red" id="resetBtn">Reset</button>
      </div>
    </div>

    <!-- MAIN -->
    <div class="card">
      <div class="titleRow">
        <h2>Attempt: Coding & Robotics MCQ (Grade 5 ‚Ä¢ 100 Questions)</h2>
        <p>Rules: Silent work. No talking. Auto-submit when time runs out.</p>
      </div>

      <div class="controls">
        <button class="btn big" id="prevBtn">Previous</button>
        <button class="btn big" id="nextBtn">Next</button>
        <button class="btn big" id="flagBtn">üèÅ Flag question</button>
        <div class="spacer"></div>
        <button class="btn big" id="finishBtn">Finish attempt</button>
        <button class="btn big brand" id="submitBtn">Submit all and finish</button>
      </div>

      <div class="content" id="content"></div>
      <div class="foot">Prepared by Mr Samuels</div>
    </div>
  </div>

<script>
/* =========================
   SUPABASE CONFIG
   ========================= */
const SUPABASE_URL = "https://tcofqcoeqptjdjawgohb.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_3ud-FlpJ9AZZDIzVkZ1EoA_B7c-Vs7B";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* =========================
   QUIZ DATA (Grade 5 ‚Ä¢ 100 unique)
   ========================= */
function buildQuestions(){
  const Q = [
    // 1‚Äì20: Basic computer & devices
    {text:"What is hardware?", choices:["Programs and apps","Physical parts of a computer","Internet connection","A password"], correct:1},
    {text:"Which is an output device?", choices:["Mouse","Keyboard","Monitor","Microphone"], correct:2},
    {text:"Which is an input device?", choices:["Speaker","Printer","Mouse","Projector"], correct:2},
    {text:"What does a computer need to work?", choices:["Power (electricity)","Only headphones","Only paper","Only Wi-Fi"], correct:0},
    {text:"Which part stores files even when the computer is off?", choices:["RAM","Hard drive / SSD","Monitor","Fan"], correct:1},
    {text:"What is a browser used for?", choices:["To type faster","To view websites","To charge a device","To print only"], correct:1},
    {text:"Which one is a tablet?", choices:["iPad","Router","Keyboard","Mouse"], correct:0},
    {text:"What is a file?", choices:["A saved piece of work (document/photo)","A robot wheel","A Wi-Fi signal","A password rule"], correct:0},
    {text:"Which icon usually means ‚Äòsettings‚Äô?", choices:["Envelope","Gear/cog","Play button","Camera"], correct:1},
    {text:"What does ‚Äòvolume‚Äô control?", choices:["Screen brightness","Sound level","Internet speed","Battery size"], correct:1},

    {text:"Which is used to print on paper?", choices:["Printer","Scanner","Speaker","Mouse"], correct:0},
    {text:"What is ‚Äòstorage‚Äô mainly for?", choices:["To make the screen bigger","To save files and apps","To play music louder","To connect to Bluetooth"], correct:1},
    {text:"What does ‚Äòbattery percentage‚Äô show?", choices:["How fast Wi-Fi is","How much charge is left","How many apps you have","How bright the screen is"], correct:1},
    {text:"Which is NOT hardware?", choices:["Keyboard","Monitor","Scratch","Mouse"], correct:2},
    {text:"What is an app?", choices:["A program you can use on a device","A type of cable","A computer part","A password"], correct:0},
    {text:"Which is safest for carrying an iPad?", choices:["One hand while running","Two hands or a protective cover","Under your shirt","By the charging cable"], correct:1},
    {text:"What does ‚Äòupdate‚Äô usually mean?", choices:["Make it older","Fix and improve software","Delete everything","Turn off Wi-Fi"], correct:1},
    {text:"Which is used to take a photo?", choices:["Camera","Printer","Keyboard","Router"], correct:0},
    {text:"What does a touchscreen do?", choices:["Only plays music","Lets you control by touching the screen","Makes Wi-Fi faster","Prints documents"], correct:1},
    {text:"Which key usually deletes text?", choices:["Enter","Backspace","Shift","Ctrl"], correct:1},

    // 21‚Äì40: Internet safety & email basics
    {text:"Which password is strongest?", choices:["123456","password","MyName2024","BlueTiger!9River"], correct:3},
    {text:"Why should you NOT share your password?", choices:["So your screen is brighter","Someone could access your account","It makes typing slower","It stops Wi-Fi"], correct:1},
    {text:"What is personal information?", choices:["Your favourite colour","Your home address and phone number","A cartoon character","A game level"], correct:1},
    {text:"If a website asks for your password, you should:", choices:["Give it immediately","Ask a trusted adult/teacher first","Post it in a group chat","Write it on your iPad cover"], correct:1},
    {text:"What does ‚Äòlog in‚Äô mean?", choices:["Turn volume up","Enter your account details","Delete an app","Take a photo"], correct:1},
    {text:"What does ‚Äòlog out‚Äô help with?", choices:["Keeps your account safe","Makes Wi-Fi faster","Charges the iPad","Prints your work"], correct:0},
    {text:"What is phishing?", choices:["Catching fish","Tricking people to share passwords/info","A type of keyboard","A robot part"], correct:1},
    {text:"A safe rule online is:", choices:["Click all pop-ups","Never tell an adult anything","Be kind and don‚Äôt share private info","Use the same password everywhere"], correct:2},
    {text:"If you see something scary online, you should:", choices:["Keep it secret","Tell a trusted adult/teacher","Send it to friends","Delete the browser"], correct:1},
    {text:"What is an email ‚Äòsubject‚Äô?", choices:["The greeting","The topic line of the email","The signature","The attachment"], correct:1},

    {text:"What is an attachment?", choices:["A topic line","A file added to an email","A password","A website"], correct:1},
    {text:"What does ‚ÄòCC‚Äô mean in email?", choices:["Copy someone in so they can see it","Cancel message","Change colour","Close chat"], correct:0},
    {text:"What does ‚ÄòBCC‚Äô do?", choices:["Shows everyone‚Äôs addresses","Hides recipients from each other","Deletes the email","Blocks Wi-Fi"], correct:1},
    {text:"A polite email greeting is:", choices:["Yo","Hey you","Dear Sir/Madam / Hello","Give me this now"], correct:2},
    {text:"A good email ending is:", choices:["Bye loser","Thanks / Kind regards","Whatever","No ending needed"], correct:1},
    {text:"Why should we check spelling before sending?", choices:["It wastes time","It makes the email clear and professional","It stops the email","It breaks the keyboard"], correct:1},
    {text:"What should you do before clicking a link?", choices:["Click fast","Check if it‚Äôs safe and from someone you trust","Share it everywhere","Turn off the iPad"], correct:1},
    {text:"What does ‚ÄòWi-Fi‚Äô help you do?", choices:["Connect to the internet without a cable","Print without paper","Charge the iPad","Increase storage"], correct:0},
    {text:"Which is safe to share online?", choices:["Your password","Your home address","A project about robots","Your phone number"], correct:2},
    {text:"If someone is unkind online, you should:", choices:["Be unkind back","Block/report and tell an adult/teacher","Give them your password","Meet them after school"], correct:1},

    // 41‚Äì70: Coding concepts + Scratch
    {text:"A ‚Äòprogram‚Äô is:", choices:["A robot wheel","A set of instructions","A password","A charger"], correct:1},
    {text:"What is an algorithm?", choices:["A dance move","Steps to solve a problem","A type of screen","A speaker"], correct:1},
    {text:"What does a loop do?", choices:["Stops code","Repeats instructions","Deletes a file","Turns off Wi-Fi"], correct:1},
    {text:"In Scratch, which blocks are used for repeating?", choices:["Looks","Events","Control","Sound"], correct:2},
    {text:"In Scratch, which block starts a project?", choices:["When green flag clicked","Say hello","Move 10 steps","Wait 1 second"], correct:0},
    {text:"A bug in a program is:", choices:["A small insect","A mistake/error in code","A battery","A mouse"], correct:1},
    {text:"Debugging means:", choices:["Making code worse","Finding and fixing mistakes","Turning off the device","Deleting your work"], correct:1},
    {text:"A variable is used to:", choices:["Play music","Store information (like a score)","Charge a robot","Print a page"], correct:1},
    {text:"Which is an example of a variable?", choices:["Score","Keyboard","Monitor","Speaker"], correct:0},
    {text:"In Scratch, sprites are:", choices:["Internet pages","Characters/objects you control","Passwords","Folders"], correct:1},

    {text:"Which block category moves a sprite?", choices:["Motion","Sound","Looks","Control"], correct:0},
    {text:"Which block category changes how a sprite looks?", choices:["Looks","Motion","Events","Control"], correct:0},
    {text:"Which block category detects touching or mouse?", choices:["Sensing","Sound","Motion","Pen"], correct:0},
    {text:"When you ‚Äòsave‚Äô your work, you:", choices:["Delete it","Keep it for later","Make it a photo","Turn it off"], correct:1},
    {text:"What does ‚Äòrun a program‚Äô mean?", choices:["Open and execute it","Print it","Charge it","Hide it"], correct:0},
    {text:"An ‚Äòevent‚Äô in Scratch is:", choices:["A mistake","Something that triggers code to start","A speaker","A charger"], correct:1},
    {text:"If code runs in the wrong order, you should:", choices:["Ignore it","Check the sequence/steps","Break the iPad","Change the wallpaper"], correct:1},
    {text:"A flowchart is:", choices:["A map of steps in a process","A music chart","A robot battery","A keyboard setting"], correct:0},
    {text:"The correct order for solving a coding problem is:", choices:["Guess, submit, forget","Plan, build, test, improve","Sleep, delete, restart","Copy, paste, done"], correct:1},
    {text:"If a sprite keeps moving forever, you may have used:", choices:["A loop","A delete block","A stop button","A volume key"], correct:0},

    // 71‚Äì100: Robotics & sensors + digital citizenship
    {text:"A robot is:", choices:["Only a computer game","A machine that can follow instructions","A notebook","A pencil"], correct:1},
    {text:"A sensor helps a robot to:", choices:["Eat food","Sense/measure things around it","Sleep","Draw pictures"], correct:1},
    {text:"Which sensor detects light?", choices:["Light sensor","Speaker","Keyboard","Printer"], correct:0},
    {text:"Which sensor can help avoid bumping into walls?", choices:["Distance sensor","Paintbrush","Microphone","Paper"], correct:0},
    {text:"A motor is used to:", choices:["Store passwords","Make movement happen","Send emails","Increase Wi-Fi"], correct:1},
    {text:"A battery in a robot is for:", choices:["Power","Internet","Sound only","Printing"], correct:0},
    {text:"What does ‚Äòinput‚Äô mean for a robot?", choices:["Information going in (sensor reading)","The robot‚Äôs colour","A printer","A trophy"], correct:0},
    {text:"What does ‚Äòoutput‚Äô mean for a robot?", choices:["What the robot does (move/light/sound)","A password","A website","A file name"], correct:0},
    {text:"If a robot‚Äôs wheel is loose, that is a:", choices:["Software problem","Hardware problem","Wi-Fi problem","Email problem"], correct:1},
    {text:"If Scratch code is wrong, that is a:", choices:["Hardware problem","Software problem","Battery problem","Mouse problem"], correct:1},

    {text:"Being a good digital citizen means:", choices:["Being rude online","Being safe and respectful online","Sharing passwords","Posting private info"], correct:1},
    {text:"Which is the best action before posting a photo online?", choices:["Post immediately","Ask permission and think first","Tag strangers","Share your password too"], correct:1},
    {text:"Cyberbullying is:", choices:["Helping someone","Being mean online repeatedly","Typing fast","Fixing bugs"], correct:1},
    {text:"If you make a mistake in an email, you should:", choices:["Panic","Correct it and resend politely","Never email again","Send angry messages"], correct:1},
    {text:"A good filename for your work is:", choices:["asdf123","finalfinalfinal","G5_Robotics_Quiz_Fred_18Feb","????"], correct:2},
    {text:"What does ‚Äòcloud‚Äô storage mean?", choices:["Saving files online","Saving only on paper","Turning off Wi-Fi","A weather app"], correct:0},
    {text:"Which is a safe place to save school work?", choices:["A random website","Google Drive / school platform","A stranger‚Äôs email","Public chat"], correct:1},
    {text:"If your iPad freezes, you should first:", choices:["Throw it","Try closing the app and restarting","Delete everything","Remove the screen"], correct:1},
    {text:"What does ‚Äòmute‚Äô do?", choices:["Turns sound off","Turns Wi-Fi off","Deletes apps","Brightens screen"], correct:0},
    {text:"When you copy and paste from the internet, you should:", choices:["Pretend it‚Äôs yours","Give credit / use your own words","Hide it","Never learn"], correct:1},

    {text:"Which is a strong rule for passwords?", choices:["Share it with friends","Use the same one everywhere","Use a long password and keep it secret","Write it on your desk"], correct:2},
    {text:"What is ‚Äòdrag and drop‚Äô?", choices:["Throwing the iPad","Moving something by holding and sliding","Deleting a folder","Printing a page"], correct:1},
    {text:"What does a ‚Äòsearch bar‚Äô do?", choices:["Plays music","Finds information on a site/app","Charges the iPad","Takes photos"], correct:1},
    {text:"What is the purpose of a ‚Äòfolder‚Äô?", choices:["To organise files","To increase battery","To connect Wi-Fi","To print"], correct:0},
    {text:"Which is a good way to keep your device safe?", choices:["Leave it on the floor","Use a cover and handle carefully","Pull the cable","Hit the screen"], correct:1},
    {text:"What does ‚Äòrestart‚Äô mean?", choices:["Turn off and on again","Break the iPad","Delete files","Call a friend"], correct:0},
    {text:"Which is a safe online habit?", choices:["Click pop-ups","Use kind language and report problems","Share private info","Meet strangers"], correct:1},
    {text:"What does ‚Äòupload‚Äô mean?", choices:["Send a file to the internet/cloud","Take a nap","Delete a file","Turn volume up"], correct:0},
    {text:"What does ‚Äòdownload‚Äô mean?", choices:["Get a file from the internet to your device","Break a robot","Charge a battery","Print without ink"], correct:0},
    {text:"What does a ‚Äòrobot arm‚Äô usually do?", choices:["Moves objects","Plays music","Prints documents","Makes Wi-Fi"], correct:0},

    {text:"If a robot does the wrong action, you should:", choices:["Change the instructions/program","Paint it","Add stickers","Turn volume up"], correct:0},
    {text:"A good test for a program is:", choices:["Never run it","Run it and check if it works correctly","Delete it","Email it"], correct:1},
    {text:"What is a ‚Äòsequence‚Äô in coding?", choices:["Random steps","Steps in the correct order","A battery","A screen"], correct:1},
    {text:"What is ‚Äòiteration‚Äô in coding?", choices:["Repeating a process","Charging a device","Taking a photo","Typing a password"], correct:0},
    {text:"Which Scratch block can stop everything?", choices:["Stop all","Move 10 steps","Say hello","Play sound"], correct:0},
    {text:"In Scratch, ‚Äòforever‚Äô is used to:", choices:["Repeat code without stopping","Delete sprites","Change password","Turn Wi-Fi off"], correct:0},
    {text:"In Scratch, ‚Äòwait 1 second‚Äô helps by:", choices:["Adding a pause","Making Wi-Fi faster","Saving storage","Turning sound off"], correct:0},
    {text:"What is a ‚Äòcondition‚Äô in coding?", choices:["A rule like IF something happens","A charger","A mouse","A printer"], correct:0},
    {text:"An IF statement is used to:", choices:["Make a decision in code","Increase volume","Print a page","Draw a picture"], correct:0},
    {text:"In Scratch, ‚Äòtouching‚Äô is found in:", choices:["Sensing","Motion","Sound","Looks"], correct:0},

    {text:"Which is an example of respectful online behavior?", choices:["Insults","Helping politely","Sharing passwords","Spamming"], correct:1},
    {text:"What should you do if you forget your password?", choices:["Guess forever","Ask the teacher/parent to reset it","Use your friend‚Äôs account","Stop using devices"], correct:1},
    {text:"Why do we name files properly?", choices:["To confuse ourselves","To find and organise work easily","To make Wi-Fi faster","To delete them"], correct:1},
    {text:"A good way to improve typing is:", choices:["Never practise","Practise a little each day","Type with one finger only","Avoid home row"], correct:1},
    {text:"Which is safest when using shared iPads?", choices:["Stay logged in","Log out after use","Share your password","Change settings"], correct:1},
    {text:"What does ‚Äòairplane mode‚Äô do?", choices:["Turns off wireless connections","Charges faster","Deletes apps","Prints"], correct:0},
    {text:"What is a ‚ÄòQR code‚Äô used for?", choices:["A secret password","Quickly opening a link/info by scanning","Making sound louder","Printing"], correct:1},
    {text:"If an app asks to access your camera, you should:", choices:["Allow always","Ask why and get permission if needed","Share your password","Ignore all rules"], correct:1},
    {text:"A robot following a line uses a:", choices:["Line/colour sensor","Speaker","Keyboard","Printer"], correct:0},
    {text:"What is the best first step in robotics building?", choices:["Glue everything immediately","Plan and check parts first","Turn off the battery","Run away"], correct:1},
  ];

  // ensure exactly 100 questions
  if(Q.length !== 100){
    // If you ever edit this list, this helps you catch it.
    console.warn("Question bank count is", Q.length, "(expected 100)");
  }

  return Q.map((item, i)=>({
    id: i+1,
    text: item.text,
    choices: item.choices,
    correct: item.correct
  }));
}

const QUESTIONS = buildQuestions();

/* =========================
   STATE
   ========================= */
const state = {
  idx: 0,
  answers: Array(100).fill(null),
  flagged: Array(100).fill(false),
  submitted: false,
  secondsLeft: 35*60,
  timerId: null,
  learner: { full_name:"", class_name:"", grade:null }
};

const $ = (id)=>document.getElementById(id);

const content = $("content");
const navGrid = $("navGrid");
const timeLeftEl = $("timeLeft");

/* =========================
   NAV GRID
   ========================= */
function renderNav(){
  navGrid.innerHTML = "";
  for(let i=0;i<100;i++){
    const b = document.createElement("button");
    b.className = "qbtn";
    b.textContent = (i+1);

    if(state.answers[i] !== null) b.classList.add("answered");
    if(state.flagged[i]) b.classList.add("flagged");
    if(i === state.idx) b.classList.add("active");

    b.onclick = ()=>{ state.idx=i; renderAll(); };
    navGrid.appendChild(b);
  }
}

/* =========================
   QUESTION RENDER
   ========================= */
function renderQuestion(){
  const q = QUESTIONS[state.idx];
  const answered = state.answers[state.idx];
  const flagged = state.flagged[state.idx];

  const learnerOk = (state.learner.full_name && state.learner.class_name && state.learner.grade);

  content.innerHTML = `
    <div class="qhead">
      <div>
        <div class="qno">Question ${q.id} / 100</div>
        <div class="qtext">${escapeHtml(q.text)}</div>
        <div class="metaLine">${flagged ? "‚öë Flagged" : ""}</div>
      </div>
      <div style="text-align:right;color:var(--muted);font-weight:900;font-size:13px">
        ${learnerOk ? `Learner: ${escapeHtml(state.learner.full_name)} ‚Ä¢ ${escapeHtml(state.learner.class_name)} ‚Ä¢ Grade ${state.learner.grade}` : `Select class + learner to record details`}
      </div>
    </div>

    ${!learnerOk ? `<div class="notice">Please select a class and learner on the left. The quiz still works, but submission will be blocked until learner info is selected.</div>` : ""}

    <div class="choices" id="choices"></div>
    <div id="resultArea"></div>
  `;

  const choicesBox = $("choices");
  q.choices.forEach((choiceText, i)=>{
    const row = document.createElement("label");
    row.className = "choice" + (answered===i ? " selected":"");
    row.innerHTML = `
      <input type="radio" name="q" ${answered===i ? "checked":""} ${state.submitted ? "disabled":""}/>
      <div><b>${String.fromCharCode(65+i)}.</b> ${escapeHtml(choiceText)}</div>
    `;
    row.onclick = ()=>{
      if(state.submitted) return;
      state.answers[state.idx] = i;
      renderAll();
    };
    choicesBox.appendChild(row);
  });

  if(state.submitted){
    renderResultBox();
  }
}

function renderResultBox(){
  const score = calcScore();
  const pct = Math.round((score/100)*100);
  $("resultArea").innerHTML = `
    <div class="resultBox">
      <div class="score">Score: ${score} / 100 (${pct}%)</div>
      <div class="small">Answered: ${countAnswered()} ‚Ä¢ Flagged: ${countFlagged()}</div>
    </div>
  `;
}

function escapeHtml(s){
  return String(s).replace(/[&<>\"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;'}[m]));
}

/* =========================
   TIMER
   ========================= */
function fmtTime(sec){
  const m = Math.floor(sec/60);
  const s = sec%60;
  return String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
}

function startTimerIfNeeded(){
  if(state.timerId) return;
  state.timerId = setInterval(()=>{
    if(state.submitted) return;
    state.secondsLeft = Math.max(0, state.secondsLeft - 1);
    timeLeftEl.textContent = fmtTime(state.secondsLeft);
    if(state.secondsLeft === 0){
      submitAll("Time is up (auto-submit).",
        false
      );
    }
  },1000);
}

function renderTime(){
  timeLeftEl.textContent = fmtTime(state.secondsLeft);
}

/* =========================
   SCORING
   ========================= */
function calcScore(){
  let score = 0;
  for(let i=0;i<100;i++){
    if(state.answers[i] === QUESTIONS[i].correct) score++;
  }
  return score;
}
function countAnswered(){
  return state.answers.filter(v=>v!==null).length;
}
function countFlagged(){
  return state.flagged.filter(Boolean).length;
}

/* =========================
   SAVE / LOAD (localStorage)
   ========================= */
const LS_KEY = "disa_g5_mcq_v1";

function saveAttempt(){
  const payload = {
    idx: state.idx,
    answers: state.answers,
    flagged: state.flagged,
    secondsLeft: state.secondsLeft,
    submitted: state.submitted,
    learner: state.learner,
    learnerBox: $("learnerBox").value,
    classBox: $("classBox").value
  };
  localStorage.setItem(LS_KEY, JSON.stringify(payload));
  alert("Saved.");
}

function loadAttempt(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return;
    const p = JSON.parse(raw);
    state.idx = p.idx ?? 0;
    state.answers = p.answers ?? state.answers;
    state.flagged = p.flagged ?? state.flagged;
    state.secondsLeft = p.secondsLeft ?? state.secondsLeft;
    state.submitted = !!p.submitted;
    state.learner = p.learner ?? state.learner;

    $("learnerBox").value = p.learnerBox || "";
    $("classBox").value = p.classBox || "";
  }catch(e){}
}

function resetAttempt(){
  if(!confirm("Reset this attempt?")) return;
  if(state.timerId){ clearInterval(state.timerId); state.timerId=null; }
  state.idx = 0;
  state.answers = Array(100).fill(null);
  state.flagged = Array(100).fill(false);
  state.submitted = false;
  state.secondsLeft = 35*60;
  state.learner = {full_name:"", class_name:"", grade:null};
  $("learnerBox").value = "";
  $("classBox").value = "";
  $("gradeView").textContent = "‚Äî";
  $("classSelect").value = "";
  $("learnerSelect").innerHTML = `<option value="">Select learner...</option>`;
  $("learnerSelect").disabled = true;
  localStorage.removeItem(LS_KEY);
  renderAll();
}

/* =========================
   SUBMIT
   ========================= */
function submitAll(reason){
  const learnerOk = (state.learner.full_name && state.learner.class_name && state.learner.grade);
  if(!learnerOk){
    alert("Please select class + learner first (left panel).");
    return;
  }

  state.submitted = true;
  renderAll();

  const score = calcScore();
  const pct = Math.round((score/100)*100);
  alert(`${reason || "Submitted."}\n\n${state.learner.full_name} (${state.learner.class_name})\nScore: ${score}/100 (${pct}%)\n\nTry again to improve your mark!`);
}

/* =========================
   BUTTONS
   ========================= */
$("prevBtn").onclick = ()=>{
  state.idx = Math.max(0, state.idx-1);
  renderAll();
};
$("nextBtn").onclick = ()=>{
  state.idx = Math.min(99, state.idx+1);
  renderAll();
};
$("flagBtn").onclick = ()=>{
  state.flagged[state.idx] = !state.flagged[state.idx];
  renderAll();
};
$("finishBtn").onclick = ()=>{
  const score = calcScore();
  const pct = Math.round((score/100)*100);
  alert(`So far:\nAnswered: ${countAnswered()}/100\nFlagged: ${countFlagged()}\nCurrent score if submitted now: ${score}/100 (${pct}%)`);
};
$("submitBtn").onclick = ()=> submitAll("Submitted by learner.");
$("saveBtn").onclick = saveAttempt;
$("resetBtn").onclick = resetAttempt;

/* =========================
   SUPABASE: LOAD DROPDOWNS
   Table expected: public.learners
   Columns: id, full_name, class_name, grade
   ========================= */
async function loadClasses(){
  try{
    const { data, error } = await sb
      .from("learners")
      .select("class_name, grade")
      .order("class_name", { ascending: true });

    if(error) throw error;

    const seen = new Set();
    const classes = [];
    (data || []).forEach(r=>{
      const cn = (r.class_name || "").trim();
      if(!cn || seen.has(cn)) return;
      seen.add(cn);
      classes.push({ class_name: cn, grade: r.grade });
    });

    const sel = $("classSelect");
    sel.innerHTML = `<option value="">Select class...</option>` + classes
      .map(c=>`<option value="${escapeHtml(c.class_name)}" data-grade="${c.grade ?? ""}">${escapeHtml(c.class_name)}</option>`)
      .join("");

  }catch(e){
    console.error(e);
    $("classSelect").innerHTML = `<option value="">(Could not load classes)</option>`;
  }
}

async function loadLearnersForClass(className){
  const lsel = $("learnerSelect");
  lsel.disabled = true;
  lsel.innerHTML = `<option value="">Loading...</option>`;

  try{
    const { data, error } = await sb
      .from("learners")
      .select("id, full_name, class_name, grade")
      .eq("class_name", className)
      .order("full_name", { ascending: true });

    if(error) throw error;

    lsel.innerHTML = `<option value="">Select learner...</option>` + (data||[])
      .map(r=>`<option value="${r.id}" data-full="${escapeHtml(r.full_name||"")}" data-class="${escapeHtml(r.class_name||"")}" data-grade="${r.grade ?? ""}">${escapeHtml(r.full_name||"")}</option>`)
      .join("");

    lsel.disabled = false;
  }catch(e){
    console.error(e);
    lsel.innerHTML = `<option value="">(Could not load learners)</option>`;
    lsel.disabled = true;
  }
}

$("classSelect").addEventListener("change", async (e)=>{
  const className = e.target.value;
  $("classBox").value = className || "";
  const gradeAttr = e.target.selectedOptions?.[0]?.getAttribute("data-grade");
  $("gradeView").textContent = gradeAttr ? String(gradeAttr) : "‚Äî";

  state.learner = {full_name:"", class_name: className||"", grade: gradeAttr ? Number(gradeAttr) : null};
  $("learnerBox").value = "";

  if(!className){
    $("learnerSelect").innerHTML = `<option value="">Select learner...</option>`;
    $("learnerSelect").disabled = true;
    renderAll();
    return;
  }
  await loadLearnersForClass(className);
  renderAll();
});

$("learnerSelect").addEventListener("change", (e)=>{
  const opt = e.target.selectedOptions?.[0];
  if(!opt || !opt.value){
    state.learner.full_name = "";
    $("learnerBox").value = "";
    renderAll();
    return;
  }
  const full = opt.getAttribute("data-full") || "";
  const cls  = opt.getAttribute("data-class") || $("classBox").value || "";
  const grd  = opt.getAttribute("data-grade");

  state.learner = { full_name: full, class_name: cls, grade: grd ? Number(grd) : null };

  $("learnerBox").value = full;
  $("classBox").value = cls;
  $("gradeView").textContent = (grd ? String(grd) : "‚Äî");

  // Start timer once learner is selected
  startTimerIfNeeded();
  renderAll();
});

/* =========================
   MAIN RENDER
   ========================= */
function renderAll(){
  renderTime();
  renderNav();
  renderQuestion();
}

(function init(){
  loadAttempt();
  renderAll();
  loadClasses();
  if(state.learner.full_name && !state.submitted) startTimerIfNeeded();
})();
</script>

</body>
</html>
